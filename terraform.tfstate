{
  "version": 4,
  "terraform_version": "1.8.4",
  "serial": 67,
  "lineage": "9af760fa-cf6e-b241-802c-907d4b854303",
  "outputs": {},
  "resources": [
    {
      "mode": "data",
      "type": "aws_caller_identity",
      "name": "current",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "account_id": "591688565785",
            "arn": "arn:aws:sts::591688565785:assumed-role/voclabs/user2723912=LONGA_KONGENANGO_Christelle",
            "id": "591688565785",
            "user_id": "AROAYTQ3DAQMWEIHKAOZO:user2723912=LONGA_KONGENANGO_Christelle"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_subnet",
      "name": "public",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "index_key": "subnet-0233efb24419dc563",
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:591688565785:subnet/subnet-0233efb24419dc563",
            "assign_ipv6_address_on_creation": false,
            "availability_zone": "us-east-1b",
            "availability_zone_id": "use1-az4",
            "available_ip_address_count": 251,
            "cidr_block": "10.8.2.0/24",
            "customer_owned_ipv4_pool": "",
            "default_for_az": false,
            "enable_dns64": false,
            "enable_lni_at_device_index": 0,
            "enable_resource_name_dns_a_record_on_launch": false,
            "enable_resource_name_dns_aaaa_record_on_launch": false,
            "filter": null,
            "id": "subnet-0233efb24419dc563",
            "ipv6_cidr_block": "",
            "ipv6_cidr_block_association_id": "",
            "ipv6_native": false,
            "map_customer_owned_ip_on_launch": false,
            "map_public_ip_on_launch": false,
            "outpost_arn": "",
            "owner_id": "591688565785",
            "private_dns_hostname_type_on_launch": "ip-name",
            "state": "available",
            "tags": {
              "Name": "SUB2"
            },
            "timeouts": null,
            "vpc_id": "vpc-0615adabf0f141fbd"
          },
          "sensitive_attributes": []
        },
        {
          "index_key": "subnet-04d321109e8a3f2f4",
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:591688565785:subnet/subnet-04d321109e8a3f2f4",
            "assign_ipv6_address_on_creation": false,
            "availability_zone": "us-east-1a",
            "availability_zone_id": "use1-az2",
            "available_ip_address_count": 249,
            "cidr_block": "10.8.1.0/24",
            "customer_owned_ipv4_pool": "",
            "default_for_az": false,
            "enable_dns64": false,
            "enable_lni_at_device_index": 0,
            "enable_resource_name_dns_a_record_on_launch": false,
            "enable_resource_name_dns_aaaa_record_on_launch": false,
            "filter": null,
            "id": "subnet-04d321109e8a3f2f4",
            "ipv6_cidr_block": "",
            "ipv6_cidr_block_association_id": "",
            "ipv6_native": false,
            "map_customer_owned_ip_on_launch": false,
            "map_public_ip_on_launch": false,
            "outpost_arn": "",
            "owner_id": "591688565785",
            "private_dns_hostname_type_on_launch": "ip-name",
            "state": "available",
            "tags": {
              "Name": "SUB1"
            },
            "timeouts": null,
            "vpc_id": "vpc-0615adabf0f141fbd"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_subnets",
      "name": "public",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "filter": [
              {
                "name": "tag:Name",
                "values": [
                  "SUB*"
                ]
              }
            ],
            "id": "us-east-1",
            "ids": [
              "subnet-04d321109e8a3f2f4",
              "subnet-0233efb24419dc563"
            ],
            "tags": null,
            "timeouts": null
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_vpc",
      "name": "selected",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:591688565785:vpc/vpc-0615adabf0f141fbd",
            "cidr_block": "10.8.0.0/16",
            "cidr_block_associations": [
              {
                "association_id": "vpc-cidr-assoc-0e12c27f2d7f7f860",
                "cidr_block": "10.8.0.0/16",
                "state": "associated"
              }
            ],
            "default": false,
            "dhcp_options_id": "dopt-0d51c4a60f672f685",
            "enable_dns_hostnames": false,
            "enable_dns_support": true,
            "enable_network_address_usage_metrics": false,
            "filter": null,
            "id": "vpc-0615adabf0f141fbd",
            "instance_tenancy": "default",
            "ipv6_association_id": "",
            "ipv6_cidr_block": "",
            "main_route_table_id": "rtb-012a2f7885e4a788e",
            "owner_id": "591688565785",
            "state": null,
            "tags": {
              "Name": "cluster-VPC"
            },
            "timeouts": null
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "local_file",
      "name": "k8s_private_key",
      "provider": "provider[\"registry.terraform.io/hashicorp/local\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content": "-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn\nNhAAAAAwEAAQAAAQEAwdP6a08MKZTryguP34M+CKmmAv09ujqcn9LYTl9RUT3+E0KpEHbx\n6IZvnzYQp28bgk8crGAvAE7Vj2eQu6dnd70CtGsosgAKOAF/gX0RKUPI98kXpzAkDBL5qL\nEraFwDIK4mLwI3dAyukCY01wejQrs2A2qejrm49ALikeC/eTqeSiTDsWlv/xl6sRx2dmDf\npdmfDAtD8ANCZhajlXUETN2fZi1ntXnFSfVFibgF47pW36NzqQ132Gc9w17DTEpIi4GdhR\n0pbCzmeasipNkUgn3O+4FF8mDYle1t7PAVwfX19t0R6+0r4khga7pKEY3v2bTIjz2JljW1\nEqfRr66+SQAAA8jgqY/64KmP+gAAAAdzc2gtcnNhAAABAQDB0/prTwwplOvKC4/fgz4Iqa\nYC/T26Opyf0thOX1FRPf4TQqkQdvHohm+fNhCnbxuCTxysYC8ATtWPZ5C7p2d3vQK0ayiy\nAAo4AX+BfREpQ8j3yRenMCQMEvmosStoXAMgriYvAjd0DK6QJjTXB6NCuzYDap6Oubj0Au\nKR4L95Op5KJMOxaW//GXqxHHZ2YN+l2Z8MC0PwA0JmFqOVdQRM3Z9mLWe1ecVJ9UWJuAXj\nulbfo3OpDXfYZz3DXsNMSkiLgZ2FHSlsLOZ5qyKk2RSCfc77gUXyYNiV7W3s8BXB9fX23R\nHr7SviSGBrukoRje/ZtMiPPYmWNbUSp9Gvrr5JAAAAAwEAAQAAAQEAuoIVVyirFV/9O1/A\nw1xwVrmXywyPVyGLEKc8CL3ja39xemsMb5Fk2VBzHApUICjjmZIyjxPGZk91ZBZNyKQfBb\nLUZXMvp4guTRHz9U+5MbHOMdBIeFH0fcHMhixlDnhrcgjhKR7C6WJCnuaEtdzdlhq6sLLp\ne4Duna4hAin3VNgMOi/QpjkVszOqx3Y6P+RfcU7IycgVc6tPAAIV5a83Skg72eoOSUM2A0\nX27LHB3LpheGByD+oya18RejnCXhsu4v7MdWnCz9937pl/ApEvNJBR/HPHWEbjSnvWvhNz\nQ3nl2nFmtnNxwnhZCZs1R6f6NBGpjbjHO5Ml1QLE/jZgAQAAAIABDti08GNCIMJnOVtiF4\nWF9zIWNqnnFR763XG7aCWwmjCFAaidqGaLKlox1SIwZaEVAm4qIHC31I7WIWBjj6eYbxo/\ntnP+ttr/JdWN2id9+2DxsusKnEhkk4orA2OPT0Lx3MJKR6qWultnwcZ8Af5a0dnT9eflEH\nF7vic5h5aDDAAAAIEA4Zp7crPAFGL4S3LIV7fmgL6hAuUH2ini6r94KMrI+VAAY9qlAzUs\nygXdN9yzvOvUcKXgHinKZe2u+W5jZJCXP8ens6kt0sEF6FnbwSDgccUL263LCwwMDIvA0a\njgWIA5mIYXKaQHUvfxaflG4EmJydkfkpfXwD8qYh/g0GtZ3EkAAACBANvxf4ZGkjomfOvP\nhkvxJ3ySQUOxk6A4jWbxEu5G9hFlSulbGnXpO42PZ+UR8PF+CgDxMh+9YzILpPbxz76Jsk\nAzaFCUbANN4VMKYNWThsSKWJnFtBI9VVvnGo6RyKkBFnCZlxzmkRN4TMRo7zMtdTr5NAcp\ns5hVE/DQPJm2mdIBAAAAD2s4cy1jbHVzdGVyLWtleQECAw==\n-----END OPENSSH PRIVATE KEY-----\n",
            "content_base64": "LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUJGd0FBQUFkemMyZ3RjbgpOaEFBQUFBd0VBQVFBQUFRRUF3ZFA2YTA4TUtaVHJ5Z3VQMzRNK0NLbW1BdjA5dWpxY245TFlUbDlSVVQzK0UwS3BFSGJ4CjZJWnZuellRcDI4YmdrOGNyR0F2QUU3VmoyZVF1NmRuZDcwQ3RHc29zZ0FLT0FGL2dYMFJLVVBJOThrWHB6QWtEQkw1cUwKRXJhRndESUs0bUx3STNkQXl1a0NZMDF3ZWpRcnMyQTJxZWpybTQ5QUxpa2VDL2VUcWVTaVREc1dsdi94bDZzUngyZG1EZgpwZG1mREF0RDhBTkNaaGFqbFhVRVROMmZaaTFudFhuRlNmVkZpYmdGNDdwVzM2TnpxUTEzMkdjOXcxN0RURXBJaTRHZGhSCjBwYkN6bWVhc2lwTmtVZ24zTys0RkY4bURZbGUxdDdQQVZ3ZlgxOXQwUjYrMHI0a2hnYTdwS0VZM3YyYlRJanoySmxqVzEKRXFmUnI2NitTUUFBQThqZ3FZLzY0S21QK2dBQUFBZHpjMmd0Y25OaEFBQUJBUURCMC9wclR3d3BsT3ZLQzQvZmd6NElxYQpZQy9UMjZPcHlmMHRoT1gxRlJQZjRUUXFrUWR2SG9obStmTmhDbmJ4dUNUeHlzWUM4QVR0V1BaNUM3cDJkM3ZRSzBheWl5CkFBbzRBWCtCZlJFcFE4ajN5UmVuTUNRTUV2bW9zU3RvWEFNZ3JpWXZBamQwREs2UUpqVFhCNk5DdXpZRGFwNk91YmowQXUKS1I0TDk1T3A1S0pNT3hhVy8vR1hxeEhIWjJZTitsMlo4TUMwUHdBMEptRnFPVmRRUk0zWjltTFdlMWVjVko5VVdKdUFYagp1bGJmbzNPcERYZllaejNEWHNOTVNraUxnWjJGSFNsc0xPWjVxeUtrMlJTQ2ZjNzdnVVh5WU5pVjdXM3M4QlhCOWZYMjNSCkhyN1N2aVNHQnJ1a29SamUvWnRNaVBQWW1XTmJVU3A5R3ZycjVKQUFBQUF3RUFBUUFBQVFFQXVvSVZWeWlyRlYvOU8xL0EKdzF4d1ZybVh5d3lQVnlHTEVLYzhDTDNqYTM5eGVtc01iNUZrMlZCekhBcFVJQ2pqbVpJeWp4UEdaazkxWkJaTnlLUWZCYgpMVVpYTXZwNGd1VFJIejlVKzVNYkhPTWRCSWVGSDBmY0hNaGl4bERuaHJjZ2poS1I3QzZXSkNudWFFdGR6ZGxocTZzTExwCmU0RHVuYTRoQWluM1ZOZ01PaS9RcGprVnN6T3F4M1k2UCtSZmNVN0l5Y2dWYzZ0UEFBSVY1YTgzU2tnNzJlb09TVU0yQTAKWDI3TEhCM0xwaGVHQnlEK295YTE4UmVqbkNYaHN1NHY3TWRXbkN6OTkzN3BsL0FwRXZOSkJSL0hQSFdFYmpTbnZXdmhOegpRM25sMm5GbXRuTnh3bmhaQ1pzMVI2ZjZOQkdwamJqSE81TWwxUUxFL2paZ0FRQUFBSUFCRHRpMDhHTkNJTUpuT1Z0aUY0CldGOXpJV05xbm5GUjc2M1hHN2FDV3dtakNGQWFpZHFHYUxLbG94MVNJd1phRVZBbTRxSUhDMzFJN1dJV0JqajZlWWJ4by8KdG5QK3R0ci9KZFdOMmlkOSsyRHhzdXNLbkVoa2s0b3JBMk9QVDBMeDNNSktSNnFXdWx0bndjWjhBZjVhMGRuVDllZmxFSApGN3ZpYzVoNWFEREFBQUFJRUE0WnA3Y3JQQUZHTDRTM0xJVjdmbWdMNmhBdVVIMmluaTZyOTRLTXJJK1ZBQVk5cWxBelVzCnlnWGROOXl6dk92VWNLWGdIaW5LWmUydStXNWpaSkNYUDhlbnM2a3Qwc0VGNkZuYndTRGdjY1VMMjYzTEN3d01ESXZBMGEKamdXSUE1bUlZWEthUUhVdmZ4YWZsRzRFbUp5ZGtma3BmWHdEOHFZaC9nMEd0WjNFa0FBQUNCQU52eGY0Wkdram9tZk92UApoa3Z4SjN5U1FVT3hrNkE0aldieEV1NUc5aEZsU3VsYkduWHBPNDJQWitVUjhQRitDZ0R4TWgrOVl6SUxwUGJ4ejc2SnNrCkF6YUZDVWJBTk40Vk1LWU5XVGhzU0tXSm5GdEJJOVZWdm5HbzZSeUtrQkZuQ1pseHpta1JONFRNUm83ek10ZFRyNU5BY3AKczVoVkUvRFFQSm0ybWRJQkFBQUFEMnM0Y3kxamJIVnpkR1Z5TFd0bGVRRUNBdz09Ci0tLS0tRU5EIE9QRU5TU0ggUFJJVkFURSBLRVktLS0tLQo=",
            "content_base64sha256": "dwhteTtLJj03B4cspGuuqgr+9HP8bFBtWrweA86cKNs=",
            "content_base64sha512": "B/OnLZJzc2B77bsypGPNzU9ZJIg6vYNU0D02kisM5MH0v8Oiqxc/AS4tljiimhG1KAgXtfoXkvVpq3UJDRhgNA==",
            "content_md5": "d4123cac5eab3bc709e39b61ee14dec1",
            "content_sha1": "670e92b49fe81db4841835a22ecbb0339fe5f037",
            "content_sha256": "77086d793b4b263d3707872ca46baeaa0afef473fc6c506d5abc1e03ce9c28db",
            "content_sha512": "07f3a72d927373607bedbb32a463cdcd4f5924883abd8354d03d36922b0ce4c1f4bfc3a2ab173f012e2d9638a29a11b5280817b5fa1792f569ab75090d186034",
            "filename": "/Users/issagars/.ssh/id_rsa_k8s",
            "id": "670e92b49fe81db4841835a22ecbb0339fe5f037"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "local_file",
      "name": "k8s_public_key",
      "provider": "provider[\"registry.terraform.io/hashicorp/local\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDB0/prTwwplOvKC4/fgz4IqaYC/T26Opyf0thOX1FRPf4TQqkQdvHohm+fNhCnbxuCTxysYC8ATtWPZ5C7p2d3vQK0ayiyAAo4AX+BfREpQ8j3yRenMCQMEvmosStoXAMgriYvAjd0DK6QJjTXB6NCuzYDap6Oubj0AuKR4L95Op5KJMOxaW//GXqxHHZ2YN+l2Z8MC0PwA0JmFqOVdQRM3Z9mLWe1ecVJ9UWJuAXjulbfo3OpDXfYZz3DXsNMSkiLgZ2FHSlsLOZ5qyKk2RSCfc77gUXyYNiV7W3s8BXB9fX23RHr7SviSGBrukoRje/ZtMiPPYmWNbUSp9Gvrr5J k8s-cluster-key\n",
            "content_base64": "c3NoLXJzYSBBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCQVFEQjAvcHJUd3dwbE92S0M0L2ZnejRJcWFZQy9UMjZPcHlmMHRoT1gxRlJQZjRUUXFrUWR2SG9obStmTmhDbmJ4dUNUeHlzWUM4QVR0V1BaNUM3cDJkM3ZRSzBheWl5QUFvNEFYK0JmUkVwUThqM3lSZW5NQ1FNRXZtb3NTdG9YQU1ncmlZdkFqZDBESzZRSmpUWEI2TkN1ellEYXA2T3ViajBBdUtSNEw5NU9wNUtKTU94YVcvL0dYcXhISFoyWU4rbDJaOE1DMFB3QTBKbUZxT1ZkUVJNM1o5bUxXZTFlY1ZKOVVXSnVBWGp1bGJmbzNPcERYZllaejNEWHNOTVNraUxnWjJGSFNsc0xPWjVxeUtrMlJTQ2ZjNzdnVVh5WU5pVjdXM3M4QlhCOWZYMjNSSHI3U3ZpU0dCcnVrb1JqZS9adE1pUFBZbVdOYlVTcDlHdnJyNUogazhzLWNsdXN0ZXIta2V5Cg==",
            "content_base64sha256": "3o2afCGFSZ1sEOgRtPlg6vEFYQsNqqpPN6rRh2ZoEVA=",
            "content_base64sha512": "NmoMl+Heb2KxCQzqf9rkLYsdjFyUJINkeoOnlyhJjfyqzb5/8h9LhmLalofYtLu6eUu/M0tptjUYqSNI8PSY7A==",
            "content_md5": "f4b5f297a088f48412e9dd1aa83286e2",
            "content_sha1": "00b85c824ffd8d63469fa6ac69f17c80d6888742",
            "content_sha256": "de8d9a7c2185499d6c10e811b4f960eaf105610b0daaaa4f37aad18766681150",
            "content_sha512": "366a0c97e1de6f62b1090cea7fdae42d8b1d8c5c942483647a83a79728498dfcaacdbe7ff21f4b8662da9687d8b4bbba794bbf334b69b63518a92348f0f498ec",
            "filename": "/Users/issagars/.ssh/id_rsa_k8s.pub",
            "id": "00b85c824ffd8d63469fa6ac69f17c80d6888742"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "template_file",
      "name": "k8s_master",
      "provider": "provider[\"registry.terraform.io/hashicorp/template\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "afb5f5793c6dd06b33f4d976a25bd55e6157bbf344697856fcece68f1e758177",
            "rendered": "#!/bin/bash\nset -e\n\n# Update and install dependencies\napt-get update -y\napt-get install -y apt-transport-https ca-certificates curl gpg unzip jq gnupg2 software-properties-common\n\n# Install AWS CLI\ncurl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"\nunzip awscliv2.zip\n./aws/install\nrm -rf awscliv2.zip aws\n\n# Add Docker's official GPG key\ninstall -m 0755 -d /etc/apt/keyrings\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc\nchmod a+r /etc/apt/keyrings/docker.asc\n\n# Add Docker repository\necho \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \\\n$(. /etc/os-release \u0026\u0026 echo \"$VERSION_CODENAME\") stable\" | tee /etc/apt/sources.list.d/docker.list \u003e /dev/null\napt-get update -y\n\n# Install Docker and its plugins\napt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n\n# Start and enable Docker service\nsystemctl start docker\nsystemctl enable docker\n\n# Install Kubernetes tools\ncurl -fsSL https://pkgs.k8s.io/core:/stable:/v1.31/deb/Release.key | gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg\necho 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.31/deb/ /' | tee /etc/apt/sources.list.d/kubernetes.list\napt-get update -y\napt-get install -y kubelet kubeadm kubectl\napt-mark hold kubelet kubeadm kubectl\n\nrm /etc/containerd/config.toml\nsystemctl restart containerd\n\n# Initialize Kubernetes master\nkubeadm init --pod-network-cidr=10.244.0.0/16\n\n# Configure kubectl for admin\nmkdir -p $HOME/.kube\ncp /etc/kubernetes/admin.conf $HOME/.kube/config\nchown $(id -u):$(id -g) $HOME/.kube/config\n\n# Apply a CNI plugin (Flannel)\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n\n# Generate the join command and store it\nkubeadm token create --print-join-command \u003e /opt/join-command.sh\nchmod 600 /opt/join-command.sh\n\n# Fetch master IP dynamically using AWS EC2 API\nROLE_TAG=\"K8sMaster\"\nAWS_REGION=\"us-east-1\"\n\nPRIVATE_IP=$(aws ec2 describe-instances \\\n  --region \"$AWS_REGION\" \\\n  --filters \"Name=tag:Role,Values=$ROLE_TAG\" \"Name=instance-state-name,Values=running\" \\\n  --query \"Reservations[].Instances[0].PrivateIpAddress\" \\\n  --output text)\n\nif [ -z \"$PRIVATE_IP\" ]; then\n  echo \"Error: Unable to find the master node. Exiting.\"\n  exit 1\nfi\n\n# Store the join command and private IP in SSM Parameter Store\naws ssm put-parameter --name \"/k8s/join-command\" --type \"String\" --value \"$(cat /opt/join-command.sh)\" --overwrite --region \"$AWS_REGION\"\naws ssm put-parameter --name \"/k8s/master-private-ip\" --type \"String\" --value \"$PRIVATE_IP\" --overwrite --region \"$AWS_REGION\"\n\necho \"Kubernetes master setup is complete. Join command and private IP have been stored in SSM Parameter Store.\"\n",
            "template": "#!/bin/bash\nset -e\n\n# Update and install dependencies\napt-get update -y\napt-get install -y apt-transport-https ca-certificates curl gpg unzip jq gnupg2 software-properties-common\n\n# Install AWS CLI\ncurl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"\nunzip awscliv2.zip\n./aws/install\nrm -rf awscliv2.zip aws\n\n# Add Docker's official GPG key\ninstall -m 0755 -d /etc/apt/keyrings\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc\nchmod a+r /etc/apt/keyrings/docker.asc\n\n# Add Docker repository\necho \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \\\n$(. /etc/os-release \u0026\u0026 echo \"$VERSION_CODENAME\") stable\" | tee /etc/apt/sources.list.d/docker.list \u003e /dev/null\napt-get update -y\n\n# Install Docker and its plugins\napt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n\n# Start and enable Docker service\nsystemctl start docker\nsystemctl enable docker\n\n# Install Kubernetes tools\ncurl -fsSL https://pkgs.k8s.io/core:/stable:/v1.31/deb/Release.key | gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg\necho 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.31/deb/ /' | tee /etc/apt/sources.list.d/kubernetes.list\napt-get update -y\napt-get install -y kubelet kubeadm kubectl\napt-mark hold kubelet kubeadm kubectl\n\nrm /etc/containerd/config.toml\nsystemctl restart containerd\n\n# Initialize Kubernetes master\nkubeadm init --pod-network-cidr=10.244.0.0/16\n\n# Configure kubectl for admin\nmkdir -p $HOME/.kube\ncp /etc/kubernetes/admin.conf $HOME/.kube/config\nchown $(id -u):$(id -g) $HOME/.kube/config\n\n# Apply a CNI plugin (Flannel)\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n\n# Generate the join command and store it\nkubeadm token create --print-join-command \u003e /opt/join-command.sh\nchmod 600 /opt/join-command.sh\n\n# Fetch master IP dynamically using AWS EC2 API\nROLE_TAG=\"K8sMaster\"\nAWS_REGION=\"${AWS_REGION}\"\n\nPRIVATE_IP=$(aws ec2 describe-instances \\\n  --region \"$AWS_REGION\" \\\n  --filters \"Name=tag:Role,Values=$ROLE_TAG\" \"Name=instance-state-name,Values=running\" \\\n  --query \"Reservations[].Instances[0].PrivateIpAddress\" \\\n  --output text)\n\nif [ -z \"$PRIVATE_IP\" ]; then\n  echo \"Error: Unable to find the master node. Exiting.\"\n  exit 1\nfi\n\n# Store the join command and private IP in SSM Parameter Store\naws ssm put-parameter --name \"/k8s/join-command\" --type \"String\" --value \"$(cat /opt/join-command.sh)\" --overwrite --region \"$AWS_REGION\"\naws ssm put-parameter --name \"/k8s/master-private-ip\" --type \"String\" --value \"$PRIVATE_IP\" --overwrite --region \"$AWS_REGION\"\n\necho \"Kubernetes master setup is complete. Join command and private IP have been stored in SSM Parameter Store.\"\n",
            "vars": {
              "AWS_REGION": "us-east-1"
            }
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "template_file",
      "name": "k8s_worker",
      "provider": "provider[\"registry.terraform.io/hashicorp/template\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "filename": null,
            "id": "fe7b501a915734037e2d19842b9212931a2c2e527f7aee4fbfd4afb96a738e05",
            "rendered": "#!/bin/bash\nset -e\n\n# Update and install dependencies\napt-get update -y\napt-get install -y apt-transport-https ca-certificates curl gpg unzip jq gnupg2 software-properties-common\n\n# Install AWS CLI\ncurl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"\nunzip awscliv2.zip\n./aws/install\nrm -rf awscliv2.zip aws\n\n# Add Docker's official GPG key\ninstall -m 0755 -d /etc/apt/keyrings\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc\nchmod a+r /etc/apt/keyrings/docker.asc\n\n# Add Docker repository\necho \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \\\n$(. /etc/os-release \u0026\u0026 echo \"$VERSION_CODENAME\") stable\" | tee /etc/apt/sources.list.d/docker.list \u003e /dev/null\napt-get update -y\n\n# Install Docker and its plugins\napt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n\n# Start and enable Docker service\nsystemctl start docker\nsystemctl enable docker\n\n# Install Kubernetes tools\ncurl -fsSL https://pkgs.k8s.io/core:/stable:/v1.31/deb/Release.key | gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg\necho 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.31/deb/ /' | tee /etc/apt/sources.list.d/kubernetes.list\napt-get update -y\napt-get install -y kubelet kubeadm kubectl\napt-mark hold kubelet kubeadm kubectl\n\nrm /etc/containerd/config.toml\nsystemctl restart containerd\n\n# Define AWS_REGION and ROLE_TAG\nAWS_REGION=\"us-east-1\" # Default to us-east-1 if AWS_REGION is not set\nROLE_TAG=\"K8sMaster\"\n\n# Fetch master IP dynamically using AWS EC2 API\nMASTER_IP=$(aws ec2 describe-instances \\\n  --region \"$AWS_REGION\" \\\n  --filters \"Name=tag:Role,Values=$ROLE_TAG\" \"Name=instance-state-name,Values=running\" \\\n  --query \"Reservations[].Instances[0].PrivateIpAddress\" \\\n  --output text)\n\nif [ -z \"$MASTER_IP\" ]; then\n  echo \"Error: Unable to find the master node. Exiting.\"\n  exit 1\nfi\n\n# Retrieve the private key from SSM (ensure directory exists and permissions are correct)\nmkdir -p /home/ubuntu/.ssh\naws ssm get-parameter --name \"/k8s/id_rsa_k8s\" --region \"$AWS_REGION\" --with-decryption --query \"Parameter.Value\" --output text \u003e /home/ubuntu/.ssh/id_rsa_k8s\nchmod 600 /home/ubuntu/.ssh/id_rsa_k8s\nchown ubuntu:ubuntu /home/ubuntu/.ssh/id_rsa_k8s\n\n# Retrieve the join command from SSM\naws ssm get-parameter --name \"/k8s/join-command\" --region \"$AWS_REGION\" --with-decryption --query \"Parameter.Value\" --output text \u003e /home/ubuntu/join-command.sh\nchmod +x /home/ubuntu/join-command.sh\nchown ubuntu:ubuntu /home/ubuntu/join-command.sh\n\n# Optionally, you can directly execute the join command\n/home/ubuntu/join-command.sh\n\necho \"Kubernetes worker node setup is complete.\"\n",
            "template": "#!/bin/bash\nset -e\n\n# Update and install dependencies\napt-get update -y\napt-get install -y apt-transport-https ca-certificates curl gpg unzip jq gnupg2 software-properties-common\n\n# Install AWS CLI\ncurl \"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\" -o \"awscliv2.zip\"\nunzip awscliv2.zip\n./aws/install\nrm -rf awscliv2.zip aws\n\n# Add Docker's official GPG key\ninstall -m 0755 -d /etc/apt/keyrings\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc\nchmod a+r /etc/apt/keyrings/docker.asc\n\n# Add Docker repository\necho \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \\\n$(. /etc/os-release \u0026\u0026 echo \"$VERSION_CODENAME\") stable\" | tee /etc/apt/sources.list.d/docker.list \u003e /dev/null\napt-get update -y\n\n# Install Docker and its plugins\napt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n\n# Start and enable Docker service\nsystemctl start docker\nsystemctl enable docker\n\n# Install Kubernetes tools\ncurl -fsSL https://pkgs.k8s.io/core:/stable:/v1.31/deb/Release.key | gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg\necho 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.31/deb/ /' | tee /etc/apt/sources.list.d/kubernetes.list\napt-get update -y\napt-get install -y kubelet kubeadm kubectl\napt-mark hold kubelet kubeadm kubectl\n\nrm /etc/containerd/config.toml\nsystemctl restart containerd\n\n# Define AWS_REGION and ROLE_TAG\nAWS_REGION=\"${AWS_REGION}\" # Default to us-east-1 if AWS_REGION is not set\nROLE_TAG=\"K8sMaster\"\n\n# Fetch master IP dynamically using AWS EC2 API\nMASTER_IP=$(aws ec2 describe-instances \\\n  --region \"$AWS_REGION\" \\\n  --filters \"Name=tag:Role,Values=$ROLE_TAG\" \"Name=instance-state-name,Values=running\" \\\n  --query \"Reservations[].Instances[0].PrivateIpAddress\" \\\n  --output text)\n\nif [ -z \"$MASTER_IP\" ]; then\n  echo \"Error: Unable to find the master node. Exiting.\"\n  exit 1\nfi\n\n# Retrieve the private key from SSM (ensure directory exists and permissions are correct)\nmkdir -p /home/ubuntu/.ssh\naws ssm get-parameter --name \"/k8s/id_rsa_k8s\" --region \"$AWS_REGION\" --with-decryption --query \"Parameter.Value\" --output text \u003e /home/ubuntu/.ssh/id_rsa_k8s\nchmod 600 /home/ubuntu/.ssh/id_rsa_k8s\nchown ubuntu:ubuntu /home/ubuntu/.ssh/id_rsa_k8s\n\n# Retrieve the join command from SSM\naws ssm get-parameter --name \"/k8s/join-command\" --region \"$AWS_REGION\" --with-decryption --query \"Parameter.Value\" --output text \u003e /home/ubuntu/join-command.sh\nchmod +x /home/ubuntu/join-command.sh\nchown ubuntu:ubuntu /home/ubuntu/join-command.sh\n\n# Optionally, you can directly execute the join command\n/home/ubuntu/join-command.sh\n\necho \"Kubernetes worker node setup is complete.\"\n",
            "vars": {
              "AWS_REGION": "us-east-1"
            }
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_instance",
      "name": "k8s_master",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "ami": "ami-04b4f1a9cf54c11d0",
            "arn": "arn:aws:ec2:us-east-1:591688565785:instance/i-08863edb9cf945f3c",
            "associate_public_ip_address": true,
            "availability_zone": "us-east-1a",
            "capacity_reservation_specification": [
              {
                "capacity_reservation_preference": "open",
                "capacity_reservation_target": []
              }
            ],
            "cpu_core_count": 1,
            "cpu_options": [
              {
                "amd_sev_snp": "",
                "core_count": 1,
                "threads_per_core": 2
              }
            ],
            "cpu_threads_per_core": 2,
            "credit_specification": [
              {
                "cpu_credits": "unlimited"
              }
            ],
            "disable_api_stop": false,
            "disable_api_termination": false,
            "ebs_block_device": [],
            "ebs_optimized": false,
            "enclave_options": [
              {
                "enabled": false
              }
            ],
            "ephemeral_block_device": [],
            "get_password_data": false,
            "hibernation": false,
            "host_id": "",
            "host_resource_group_arn": null,
            "iam_instance_profile": "LabInstanceProfile",
            "id": "i-08863edb9cf945f3c",
            "instance_initiated_shutdown_behavior": "stop",
            "instance_state": "running",
            "instance_type": "t3.medium",
            "ipv6_address_count": 0,
            "ipv6_addresses": [],
            "key_name": "k8s-cluster-key",
            "launch_template": [],
            "maintenance_options": [
              {
                "auto_recovery": "default"
              }
            ],
            "metadata_options": [
              {
                "http_endpoint": "enabled",
                "http_put_response_hop_limit": 2,
                "http_tokens": "required",
                "instance_metadata_tags": "disabled"
              }
            ],
            "monitoring": false,
            "network_interface": [],
            "outpost_arn": "",
            "password_data": "",
            "placement_group": "",
            "placement_partition_number": 0,
            "primary_network_interface_id": "eni-051df1d2ebe2004c2",
            "private_dns": "ip-10-8-1-63.ec2.internal",
            "private_dns_name_options": [
              {
                "enable_resource_name_dns_a_record": false,
                "enable_resource_name_dns_aaaa_record": false,
                "hostname_type": "ip-name"
              }
            ],
            "private_ip": "10.8.1.63",
            "public_dns": "",
            "public_ip": "54.89.195.194",
            "root_block_device": [
              {
                "delete_on_termination": true,
                "device_name": "/dev/sda1",
                "encrypted": false,
                "iops": 3000,
                "kms_key_id": "",
                "tags": {},
                "throughput": 125,
                "volume_id": "vol-0be56b9651784af4c",
                "volume_size": 8,
                "volume_type": "gp3"
              }
            ],
            "secondary_private_ips": [],
            "security_groups": [],
            "source_dest_check": true,
            "subnet_id": "subnet-04d321109e8a3f2f4",
            "tags": {
              "Name": "k8s-master",
              "Role": "K8sMaster"
            },
            "tags_all": {
              "Name": "k8s-master",
              "Role": "K8sMaster"
            },
            "tenancy": "default",
            "timeouts": null,
            "user_data": "91518b40a3df03a1b5b0176dc11208377ecb446c",
            "user_data_base64": null,
            "user_data_replace_on_change": false,
            "volume_tags": null,
            "vpc_security_group_ids": [
              "sg-0ea747e3e034fa946"
            ]
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMDB9LCJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "aws_key_pair.k8s_key",
            "aws_security_group.master_sg",
            "data.aws_subnets.public",
            "data.aws_vpc.selected",
            "data.local_file.k8s_public_key",
            "data.template_file.k8s_master",
            "null_resource.generate_ssh_key"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_instance",
      "name": "k8s_worker",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 1,
          "attributes": {
            "ami": "ami-04b4f1a9cf54c11d0",
            "arn": "arn:aws:ec2:us-east-1:591688565785:instance/i-0cab449408ec6dd29",
            "associate_public_ip_address": true,
            "availability_zone": "us-east-1a",
            "capacity_reservation_specification": [
              {
                "capacity_reservation_preference": "open",
                "capacity_reservation_target": []
              }
            ],
            "cpu_core_count": 1,
            "cpu_options": [
              {
                "amd_sev_snp": "",
                "core_count": 1,
                "threads_per_core": 2
              }
            ],
            "cpu_threads_per_core": 2,
            "credit_specification": [
              {
                "cpu_credits": "unlimited"
              }
            ],
            "disable_api_stop": false,
            "disable_api_termination": false,
            "ebs_block_device": [],
            "ebs_optimized": false,
            "enclave_options": [
              {
                "enabled": false
              }
            ],
            "ephemeral_block_device": [],
            "get_password_data": false,
            "hibernation": false,
            "host_id": "",
            "host_resource_group_arn": null,
            "iam_instance_profile": "LabInstanceProfile",
            "id": "i-0cab449408ec6dd29",
            "instance_initiated_shutdown_behavior": "stop",
            "instance_state": "running",
            "instance_type": "t3.medium",
            "ipv6_address_count": 0,
            "ipv6_addresses": [],
            "key_name": "k8s-cluster-key",
            "launch_template": [],
            "maintenance_options": [
              {
                "auto_recovery": "default"
              }
            ],
            "metadata_options": [
              {
                "http_endpoint": "enabled",
                "http_put_response_hop_limit": 2,
                "http_tokens": "required",
                "instance_metadata_tags": "disabled"
              }
            ],
            "monitoring": false,
            "network_interface": [],
            "outpost_arn": "",
            "password_data": "",
            "placement_group": "",
            "placement_partition_number": 0,
            "primary_network_interface_id": "eni-07fb00edd784adbdf",
            "private_dns": "ip-10-8-1-234.ec2.internal",
            "private_dns_name_options": [
              {
                "enable_resource_name_dns_a_record": false,
                "enable_resource_name_dns_aaaa_record": false,
                "hostname_type": "ip-name"
              }
            ],
            "private_ip": "10.8.1.234",
            "public_dns": "",
            "public_ip": "3.83.112.255",
            "root_block_device": [
              {
                "delete_on_termination": true,
                "device_name": "/dev/sda1",
                "encrypted": false,
                "iops": 3000,
                "kms_key_id": "",
                "tags": {},
                "throughput": 125,
                "volume_id": "vol-082997ddc574362b1",
                "volume_size": 8,
                "volume_type": "gp3"
              }
            ],
            "secondary_private_ips": [],
            "security_groups": [],
            "source_dest_check": true,
            "subnet_id": "subnet-04d321109e8a3f2f4",
            "tags": {
              "Name": "k8s-worker-1",
              "Role": "K8sWorker"
            },
            "tags_all": {
              "Name": "k8s-worker-1",
              "Role": "K8sWorker"
            },
            "tenancy": "default",
            "timeouts": null,
            "user_data": "6938650b48b27e1f8480442e31b0ad909b5d5a58",
            "user_data_base64": null,
            "user_data_replace_on_change": false,
            "volume_tags": null,
            "vpc_security_group_ids": [
              "sg-0a57e76b307ec5251"
            ]
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMDB9LCJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "aws_instance.k8s_master",
            "aws_key_pair.k8s_key",
            "aws_security_group.master_sg",
            "aws_security_group.worker_sg",
            "data.aws_subnets.public",
            "data.aws_vpc.selected",
            "data.local_file.k8s_public_key",
            "data.template_file.k8s_master",
            "data.template_file.k8s_worker",
            "null_resource.generate_ssh_key"
          ]
        },
        {
          "index_key": 1,
          "schema_version": 1,
          "attributes": {
            "ami": "ami-04b4f1a9cf54c11d0",
            "arn": "arn:aws:ec2:us-east-1:591688565785:instance/i-0f08983ee17dfc484",
            "associate_public_ip_address": true,
            "availability_zone": "us-east-1b",
            "capacity_reservation_specification": [
              {
                "capacity_reservation_preference": "open",
                "capacity_reservation_target": []
              }
            ],
            "cpu_core_count": 1,
            "cpu_options": [
              {
                "amd_sev_snp": "",
                "core_count": 1,
                "threads_per_core": 2
              }
            ],
            "cpu_threads_per_core": 2,
            "credit_specification": [
              {
                "cpu_credits": "unlimited"
              }
            ],
            "disable_api_stop": false,
            "disable_api_termination": false,
            "ebs_block_device": [],
            "ebs_optimized": false,
            "enclave_options": [
              {
                "enabled": false
              }
            ],
            "ephemeral_block_device": [],
            "get_password_data": false,
            "hibernation": false,
            "host_id": "",
            "host_resource_group_arn": null,
            "iam_instance_profile": "LabInstanceProfile",
            "id": "i-0f08983ee17dfc484",
            "instance_initiated_shutdown_behavior": "stop",
            "instance_state": "running",
            "instance_type": "t3.medium",
            "ipv6_address_count": 0,
            "ipv6_addresses": [],
            "key_name": "k8s-cluster-key",
            "launch_template": [],
            "maintenance_options": [
              {
                "auto_recovery": "default"
              }
            ],
            "metadata_options": [
              {
                "http_endpoint": "enabled",
                "http_put_response_hop_limit": 2,
                "http_tokens": "required",
                "instance_metadata_tags": "disabled"
              }
            ],
            "monitoring": false,
            "network_interface": [],
            "outpost_arn": "",
            "password_data": "",
            "placement_group": "",
            "placement_partition_number": 0,
            "primary_network_interface_id": "eni-0ac8a31ec21cdaf97",
            "private_dns": "ip-10-8-2-171.ec2.internal",
            "private_dns_name_options": [
              {
                "enable_resource_name_dns_a_record": false,
                "enable_resource_name_dns_aaaa_record": false,
                "hostname_type": "ip-name"
              }
            ],
            "private_ip": "10.8.2.171",
            "public_dns": "",
            "public_ip": "3.91.29.48",
            "root_block_device": [
              {
                "delete_on_termination": true,
                "device_name": "/dev/sda1",
                "encrypted": false,
                "iops": 3000,
                "kms_key_id": "",
                "tags": {},
                "throughput": 125,
                "volume_id": "vol-0bd379ab3fa6e672d",
                "volume_size": 8,
                "volume_type": "gp3"
              }
            ],
            "secondary_private_ips": [],
            "security_groups": [],
            "source_dest_check": true,
            "subnet_id": "subnet-0233efb24419dc563",
            "tags": {
              "Name": "k8s-worker-2",
              "Role": "K8sWorker"
            },
            "tags_all": {
              "Name": "k8s-worker-2",
              "Role": "K8sWorker"
            },
            "tenancy": "default",
            "timeouts": null,
            "user_data": "6938650b48b27e1f8480442e31b0ad909b5d5a58",
            "user_data_base64": null,
            "user_data_replace_on_change": false,
            "volume_tags": null,
            "vpc_security_group_ids": [
              "sg-0a57e76b307ec5251"
            ]
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwidXBkYXRlIjo2MDAwMDAwMDAwMDB9LCJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "aws_instance.k8s_master",
            "aws_key_pair.k8s_key",
            "aws_security_group.master_sg",
            "aws_security_group.worker_sg",
            "data.aws_subnets.public",
            "data.aws_vpc.selected",
            "data.local_file.k8s_public_key",
            "data.template_file.k8s_master",
            "data.template_file.k8s_worker",
            "null_resource.generate_ssh_key"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_key_pair",
      "name": "k8s_key",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:591688565785:key-pair/k8s-cluster-key",
            "fingerprint": "30:5f:a5:a7:5a:11:4f:a1:17:32:0e:45:ed:91:c6:15",
            "id": "k8s-cluster-key",
            "key_name": "k8s-cluster-key",
            "key_name_prefix": "",
            "key_pair_id": "key-033e8fff6a035c3fa",
            "key_type": "rsa",
            "public_key": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDB0/prTwwplOvKC4/fgz4IqaYC/T26Opyf0thOX1FRPf4TQqkQdvHohm+fNhCnbxuCTxysYC8ATtWPZ5C7p2d3vQK0ayiyAAo4AX+BfREpQ8j3yRenMCQMEvmosStoXAMgriYvAjd0DK6QJjTXB6NCuzYDap6Oubj0AuKR4L95Op5KJMOxaW//GXqxHHZ2YN+l2Z8MC0PwA0JmFqOVdQRM3Z9mLWe1ecVJ9UWJuAXjulbfo3OpDXfYZz3DXsNMSkiLgZ2FHSlsLOZ5qyKk2RSCfc77gUXyYNiV7W3s8BXB9fX23RHr7SviSGBrukoRje/ZtMiPPYmWNbUSp9Gvrr5J k8s-cluster-key",
            "tags": {},
            "tags_all": {}
          },
          "sensitive_attributes": [],
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "data.local_file.k8s_public_key",
            "null_resource.generate_ssh_key"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group",
      "name": "master_sg",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:591688565785:security-group/sg-0ea747e3e034fa946",
            "description": "Allow communication for Kubernetes master node",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": false,
                "to_port": 0
              }
            ],
            "id": "sg-0ea747e3e034fa946",
            "ingress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 22,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 22
              },
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 6443,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 6443
              }
            ],
            "name": "k8s-master-sg",
            "name_prefix": "",
            "owner_id": "591688565785",
            "revoke_rules_on_delete": false,
            "tags": {},
            "tags_all": {},
            "timeouts": null,
            "vpc_id": "vpc-0615adabf0f141fbd"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6OTAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0=",
          "dependencies": [
            "data.aws_vpc.selected"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group",
      "name": "worker_sg",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-east-1:591688565785:security-group/sg-0a57e76b307ec5251",
            "description": "Allow communication for Kubernetes worker nodes",
            "egress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 0,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "-1",
                "security_groups": [],
                "self": false,
                "to_port": 0
              }
            ],
            "id": "sg-0a57e76b307ec5251",
            "ingress": [
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 10250,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 10250
              },
              {
                "cidr_blocks": [
                  "0.0.0.0/0"
                ],
                "description": "",
                "from_port": 22,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [],
                "self": false,
                "to_port": 22
              }
            ],
            "name": "k8s-worker-sg",
            "name_prefix": "",
            "owner_id": "591688565785",
            "revoke_rules_on_delete": false,
            "tags": {},
            "tags_all": {},
            "timeouts": null,
            "vpc_id": "vpc-0615adabf0f141fbd"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6OTAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0=",
          "dependencies": [
            "data.aws_vpc.selected"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_ssm_parameter",
      "name": "k8s_private_key",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "allowed_pattern": "",
            "arn": "arn:aws:ssm:us-east-1:591688565785:parameter/k8s/id_rsa_k8s",
            "data_type": "text",
            "description": "Clé privée pour les nœuds Kubernetes",
            "id": "/k8s/id_rsa_k8s",
            "insecure_value": null,
            "key_id": "alias/aws/ssm",
            "name": "/k8s/id_rsa_k8s",
            "overwrite": null,
            "tags": {},
            "tags_all": {},
            "tier": "Standard",
            "type": "SecureString",
            "value": "-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn\nNhAAAAAwEAAQAAAQEAwdP6a08MKZTryguP34M+CKmmAv09ujqcn9LYTl9RUT3+E0KpEHbx\n6IZvnzYQp28bgk8crGAvAE7Vj2eQu6dnd70CtGsosgAKOAF/gX0RKUPI98kXpzAkDBL5qL\nEraFwDIK4mLwI3dAyukCY01wejQrs2A2qejrm49ALikeC/eTqeSiTDsWlv/xl6sRx2dmDf\npdmfDAtD8ANCZhajlXUETN2fZi1ntXnFSfVFibgF47pW36NzqQ132Gc9w17DTEpIi4GdhR\n0pbCzmeasipNkUgn3O+4FF8mDYle1t7PAVwfX19t0R6+0r4khga7pKEY3v2bTIjz2JljW1\nEqfRr66+SQAAA8jgqY/64KmP+gAAAAdzc2gtcnNhAAABAQDB0/prTwwplOvKC4/fgz4Iqa\nYC/T26Opyf0thOX1FRPf4TQqkQdvHohm+fNhCnbxuCTxysYC8ATtWPZ5C7p2d3vQK0ayiy\nAAo4AX+BfREpQ8j3yRenMCQMEvmosStoXAMgriYvAjd0DK6QJjTXB6NCuzYDap6Oubj0Au\nKR4L95Op5KJMOxaW//GXqxHHZ2YN+l2Z8MC0PwA0JmFqOVdQRM3Z9mLWe1ecVJ9UWJuAXj\nulbfo3OpDXfYZz3DXsNMSkiLgZ2FHSlsLOZ5qyKk2RSCfc77gUXyYNiV7W3s8BXB9fX23R\nHr7SviSGBrukoRje/ZtMiPPYmWNbUSp9Gvrr5JAAAAAwEAAQAAAQEAuoIVVyirFV/9O1/A\nw1xwVrmXywyPVyGLEKc8CL3ja39xemsMb5Fk2VBzHApUICjjmZIyjxPGZk91ZBZNyKQfBb\nLUZXMvp4guTRHz9U+5MbHOMdBIeFH0fcHMhixlDnhrcgjhKR7C6WJCnuaEtdzdlhq6sLLp\ne4Duna4hAin3VNgMOi/QpjkVszOqx3Y6P+RfcU7IycgVc6tPAAIV5a83Skg72eoOSUM2A0\nX27LHB3LpheGByD+oya18RejnCXhsu4v7MdWnCz9937pl/ApEvNJBR/HPHWEbjSnvWvhNz\nQ3nl2nFmtnNxwnhZCZs1R6f6NBGpjbjHO5Ml1QLE/jZgAQAAAIABDti08GNCIMJnOVtiF4\nWF9zIWNqnnFR763XG7aCWwmjCFAaidqGaLKlox1SIwZaEVAm4qIHC31I7WIWBjj6eYbxo/\ntnP+ttr/JdWN2id9+2DxsusKnEhkk4orA2OPT0Lx3MJKR6qWultnwcZ8Af5a0dnT9eflEH\nF7vic5h5aDDAAAAIEA4Zp7crPAFGL4S3LIV7fmgL6hAuUH2ini6r94KMrI+VAAY9qlAzUs\nygXdN9yzvOvUcKXgHinKZe2u+W5jZJCXP8ens6kt0sEF6FnbwSDgccUL263LCwwMDIvA0a\njgWIA5mIYXKaQHUvfxaflG4EmJydkfkpfXwD8qYh/g0GtZ3EkAAACBANvxf4ZGkjomfOvP\nhkvxJ3ySQUOxk6A4jWbxEu5G9hFlSulbGnXpO42PZ+UR8PF+CgDxMh+9YzILpPbxz76Jsk\nAzaFCUbANN4VMKYNWThsSKWJnFtBI9VVvnGo6RyKkBFnCZlxzmkRN4TMRo7zMtdTr5NAcp\ns5hVE/DQPJm2mdIBAAAAD2s4cy1jbHVzdGVyLWtleQECAw==\n-----END OPENSSH PRIVATE KEY-----\n",
            "version": 1
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "value"
              }
            ]
          ],
          "private": "bnVsbA==",
          "dependencies": [
            "data.local_file.k8s_private_key",
            "null_resource.generate_ssh_key"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "null_resource",
      "name": "generate_ssh_key",
      "provider": "provider[\"registry.terraform.io/hashicorp/null\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "2351905493634360930",
            "triggers": null
          },
          "sensitive_attributes": []
        }
      ]
    }
  ],
  "check_results": null
}
